= Rust 2019
–ê–ª–µ–∫—Å–µ–π –ö–ª–∞–¥–æ–≤ <aleksey.kladov@gmail.com>
:icons: font
:lecture: –õ–µ–∫—Ü–∏—è 1: –í–≤–µ–¥–µ–Ω–∏–µ
:table-caption!:
:example-caption!:

[.centered]
== –ü—Ä–æ –∫—É—Ä—Å

- –ù–∞—É—á–∏—Ç—å—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Rust?
- –£—Å—Ç—Ä–æ–∏—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É?

[.centered]
== –ü—Ä–æ –∫—É—Ä—Å


- –ù–∞—É—á–∏—Ç—å—Å—è –¥—É–º–∞—Ç—å –æ –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –ø–æ-–¥—Ä—É–≥–æ–º—É.
- –£–≥–ª—É–±–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ C++.

[.two-col]
== –ü—Ä–æ –º–µ–Ω—è

- https://github.com/matklad
- IntelliJ Rust
- Cargo (—Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏ Rust)
- rls 2.0 [.big]#üò®#

--
image::csc.svg[400,400]

{empty} +
{empty} +

image::ferrous.svg[500,500]
--

[.two-col]
== –ü—Ä–æ Rust

--
image::../rust-logo-blk.svg[400,400]
--

* 1.0 –≤ 2015 –≥–æ–¥—É
* –Ω–µ—Ç —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
* –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π runtime
* –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç {cpp}
* memory safety (!)

== –ß—Ç–æ —Ç–∞–∫–æ–µ Runtime?

runtime:: –∫–æ–¥ "–≤–æ–∫—Ä—É–≥" –≤–∞—à–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.

–¢–∏–ø–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞
- –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
- JIT –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
- –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏

== –¶–µ–Ω–∞ Runtime

Runtime —ç—Ç–æ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ!

–ß–µ–º –±–æ–ª—å—à–µ –¥–µ–ª–∞–µ—Ç runtime, —Ç–µ–º –º–µ–Ω—å—à–µ –Ω–∞–¥–æ –¥–µ–ª–∞—Ç—å –≤–∞–º.

{empty} +
{empty} +

–ù–æ:

- —Å–∫–æ—Ä–æ—Å—Ç—å
- —Ä–∞–∑–º–µ—Ä
- –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

== Zero Cost Abstractions

–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ C++ –∏ Rust:

NOTE: –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã

–•–æ—Ä–æ—à–∞—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è, –∫–æ–≥–¥–∞ **—Ä–µ—Å—É—Ä—Å—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã**.

== –ü—Ä–∏–º–µ—Ä (Java)

[source,java]
----
private static double average(int[] data) {
    int sum = 0;
    for (int i = 0; i < data.length; i++) {
        sum += data[i];
    }
    return sum * 1.0d / data.length;
}
----

[source,sh]
----
$ java MainJ
30 ms
----


== –ü—Ä–∏–º–µ—Ä (Rust)

[source,rust]
----
fn average(xs: &[i32]) -> f64 {
    let mut sum: i32 = 0;
    for i in 0..xs.len() {
        sum += xs[i];
    }
    sum as f64 / xs.len() as f64
}
----

[source,sh]
----
$ ./target/release/avg
???
----

== –ü—Ä–∏–º–µ—Ä (Rust)

[source,rust]
----
fn average(xs: &[i32]) -> f64 {
    let mut sum: i32 = 0;
    for i in 0..xs.len() {
        sum += xs[i];
    }
    sum as f64 / xs.len() as f64
}
----

[source,sh]
----
$ ./target/release/avg
17 ms
----

== –ü—Ä–∏–º–µ—Ä (Scala)

[source,scala]
----
def average(x: Array[Int]): Double = {
  x.reduce(_ + _) * 1.0 / x.size
}
----

[source,sh]
----
$ scala MainS
518 ms
----

== –ü—Ä–∏–º–µ—Ä (–∏ —Å–Ω–æ–≤–∞ Rust)

[source,rust]
----
fn average(xs: &[i32]) -> f64 {
    xs.iter().fold(0, |x, y| x + y) as f64 / xs.len() as f64
}
----

[source,sh]
----
$ ./target/release/avg
18 ms
----

== –ê–Ω–∞–ª–∏–∑

Java (30 ms) vs Rust (17 ms)::

–§—É–Ω–∫—Ü–∏—è –Ω–µ –∞–ª–ª–æ—Ü–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ -- –≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞.

Java (30 ms) vs Scala (518 ms)::

–§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ => –±–æ–∫—Å–∏–Ω–≥.

Rust (17 ms) vs Rust (18 ms)::

–§—É–Ω–∫—Ü–∏—è -- –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è.

== –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Runtime?

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é -- –æ–≥—Ä–æ–º–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞
- –ó–∞–∫–æ–Ω –ê–º–¥–∞–ª–∞ -- –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –≤–∞–∂–Ω–æ, –µ—Å–ª–∏ 90% —ç—Ç–æ IO
- –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é -- –ø—É—Ç—å –∫ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∏—á–µ—Å–∫–∏–º –æ—à–∏–±–∫–∞–º

NOTE: –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—É–Ω–∫—Ç -- —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É C++ –∏ Rust.

[.centered]
== –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Rust?

- –±—Ä–∞—É–∑–µ—Ä—ã: Servo –∏ Firefox
- –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: Fuschia
- –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã: Parity, Exonum
- –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: TiKV


== Hello, world

[source,rust]
----
fn main() {
    println!("Hello, World!");
}
----


[source,sh]
----
$ rustc main.rs  # –±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
$ ./main
Hello, World!
----

== Hello, world

[source,rust]
----
#![no_main]

#[link_section=".text"]
#[no_mangle]
pub static main: [u32; 9] = [
    3237986353,
    3355442993,
    120950088,
    822083584,
    252621522,
    1699267333,
    745499756,
    1919899424,
    169960556,
];
----

== Hello, Cargo

TIP: https://rustup.rs/

[source,sh,subs="quotes"]
----
$ cargo new hello-world
    [.green]*Created* binary (application) \`hello-world` package
$ cargo run --release
   Compiling hello-world v0.1.0 (/home/matklad/hello-world)
    [.green]*Finished* release [optimized] target(s) in 0.50s
     [.green]*Running* \`target/release/hello-world`
Hello, world!
----

[.title-slide]
== –û—Å–Ω–æ–≤–Ω—ã–µ –¢–∏–ø—ã

== –¶–µ–ª—ã–µ —á–∏—Å–ª–∞

|===
|–∫–æ–ª-–≤–æ –±–∏—Ç| 8 | 16 | 32 | 64 | 128 | 32/64

|–ó–Ω–∞–∫–æ–≤—ã–µ|`i8`|`i16`|`i32`|`i64`|`i128`|`isize`
|–ë–µ–∑–∑–Ω–∞–∫–æ–≤—ã–µ|`u8`|`u16`|`u32`|`u64`|`u128`|`usize`
|===

`usize` -- —Ä–∞–∑–º–µ—Ä —É–∫–∞–∑–∞—Ç–µ–ª—è

== –¶–µ–ª—ã–µ —á–∏—Å–ª–∞

- –õ–∏—Ç–µ—Ä–∞–ª—ã -- —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ + —Å—É—Ñ—Ñ–∏–∫—Å
+
[source,rust]
----
let y = 92_000_000i64;
let hex_octal_bin = 0xffff_ffff + 0o777 + 0b1;
let byte: u8 = b'a';
assert_eq!(byte, 65);
----

- –¢–∏–ø –ª–∏—Ç–µ—Ä–∞–ª–∞ –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
+
[source,rust]
----
let idx: usize = 92;
----

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é -- `i32`
+
[source, rust]
----
let int = 92;
println!("{}", int);
----

== –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

- –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: `+`, `-`, `*`, `/`
- `+/+`, `+%+` –æ–∫—Ä—É–≥–ª—è—é—Ç –∫ 0
- –±–∏—Ç–æ–≤—ã–µ/–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: `<<`, `>>`, `|`, `&`, `^`
- –∏–Ω–≤–µ—Ä—Å–∏—è –±–∏—Ç–æ–≤: `!`
- –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è –≤ —Å—Ç–µ–ø–µ–Ω—å
- –Ω–µ—Ç `++`
- –º–µ—Ç–æ–¥—ã: [.language-rust]`(-92i32).abs()`, [.language-rust]`0b001100u8.count_ones()`

== –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

–ù–µ—Ç –Ω–µ—è–≤–Ω–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

[source,rust,subs="quotes"]
----
let x: u16 = 1;

[.hl-error]##let y: u32 = x;## // error: mismatched types

let y: u32 = x.into();  // –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
let z: u16 = y as u16;  // –ë–µ—Ä—ë–º –º–ª–∞–¥—à–∏–µ –±–∏—Ç—ã

let to_usize = 92u64 as usize;
let from_usize = 92usize as u64;
----

- [.language-rust]`as` -- –æ–ø–µ—Ä–∞—Ç–æ—Ä —è–≤–Ω–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

== –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ -- –æ—à–∏–±–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞

[source,rust]
----
fn main() {
    let x = i32::max_value();
    let y = x + 1;
    println!("{}", y);
}
----

[source,sh]
----
$ cargo run
thread 'main' panicked at 'attempt to add with overflow', main.rs:3:13

$ cargo run --release
-2147483648
----

== –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞

–Ø–≤–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ —Å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º

[source,rust]
----
let x = i32::max_value();

let y = x.wrapping_add(1);
assert_eq!(y, i32::min_value());

let y = x.saturating_add(1);
assert_eq!(y, i32::max_value());

let (y, overflowed) = x.overflowing_add(1);
assert!(overflowed);
assert_eq!(y, i32::min_value())

match x.checked_add(1) {
    Some(y) => unreachable!(),
    None => println!("overflowed"),
}
----

== –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ C++

CAUTION: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ **–∑–Ω–∞–∫–æ–≤–æ–≥–æ** —Ç–∏–ø–∞ –≤ C –∏–ª–∏ C++ -- undefined behavior


.–ß—Ç–æ —Ç–∞–∫–æ–µ *–Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ*?
. –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã?
. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å –ª—é–±–æ–µ —á–∏—Å–ª–æ?
. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä—É: "—Ç–∞–∫–æ–≥–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å".

== !

.main.cpp
[source,cpp]
----
#include <climits>
#include <iostream>

bool will_overflow(int x) {
  return x > x + 1;
}

int main() {
  std::cout << will_overflow(INT_MAX) << std::endl;
}
----

[source,sh]
----
$ clang main.cpp -O0 && ./a.out
1
$ clang main.cpp -O2 && ./a.out
0
----

== With undefined behavior anything is possible

image::UB.png[]


== –ü–æ–ª—å–∑–∞ UB

[source,cpp]
----
for (int i = 0; i < m; ++i) {
    foo(xs[i]);
}
----

–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∑–∞–º–µ–Ω–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª–∏

[source,cpp]
----
for (T* it = &xs[0]; it < &xs[m]; ++it) {
    foo(*it);
}
----

–†–∞–∑–º–µ—Ä —É–∫–∞–∑–∞—Ç–µ–ª—è -- 64 –±–∏—Ç–∞, —Ä–∞–∑–º–µ—Ä `int` -- 32 –±–∏—Ç–∞.

–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–µ—Ä–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ `int` –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ.

== UB –≤ Rust

–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ Rust, –∏ –≥–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç C++:

NOTE: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UB^*^

–°—É—â–µ—Å—Ç–≤—É—é—Ç [.language-rust]`unsafe` –æ–ø–µ—Ä–∞—Ü–∏–∏: –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö
–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ `[.language-rust]#unsafe# { }`.

== –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –≤ —Å—Ç–∏–ª–µ C++

[source,rust]
----
let x = 92;
let y = unsafe { x.unchecked_add(1) };
----

- —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç
- –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –æ–±—è–∑–∞–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
- –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤–µ—Ä–∏—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –∫–æ–ª–ª–µ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞ –≤–∏–¥—è—Ç (pass:[<kbd>Ctrl+f</kbd>]) `unsafe`


== –ß–∏—Å–ª–∞ —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π (IEEE-754)

|===
|`f32`|`f64`
|===

[source,rust,subs="quotes"]
----
let y = 0.0f32;    // –ª–∏—Ç–µ—Ä–∞–ª f32
let x = 0.0;       // —Ç–∏–ø –≤—ã–≤–æ–¥–∏—Ç—Å—è, f64 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

// —Ç–æ—á–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
[.hl-error]#let z: f32 = 0;#    // error: expected f32, found integer variable
let z: f32 = 0.0;

let not_a_number: f32 = std::f32::NAN;
let inf: f32 = std::f32::INFINITY;

// –µ—Å—Ç—å –∫—É—á–∞ –º–µ—Ç–æ–¥–æ–≤
8.5f32.ceil().sin().round().sqrt()
----

== –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–∏–ø

[source,rust]
----
let to_be: bool = true;
let not_to_be = !to_be;
let the_question = to_be || not_to_be;
----

* `&&` –∏ `||` "`–ª–µ–Ω–∏–≤—ã–µ`"
* –Ω–µ—Ç –Ω–µ—è–≤–Ω–æ–≥–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ `bool`
+
[source,rust]
----
let i = 1;
let b: bool = i == 0;
let i = b as i32;
----

// 1 –±–∞–π—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ `*const bool`

== –ö–æ—Ä—Ç–µ–∂–∏

[cols="2*,2"]
|===
|`()`|`(i32,)`|`(i32, i64)`
|===

[source,rust]
----
let pair: (f32, i32) = (0.0, 92);
let (x, y) = pair;
let x = pair.0;
let y = pair.1;

let void_result = println!("hello");
assert_eq!(void_result, ());

let trailing_comma = (
    "Archibald",
    "Buttle",
);
----

== –ö–æ—Ä—Ç–µ–∂–∏

–í –ø–∞–º—è—Ç–∏ `(i32, i32)` —ç—Ç–æ –ø–∞—Ä–∞ –∏–Ω—Ç–æ–≤ (8 –±–∞–π—Ç):
|===
|`7`| `07 00 00 00`
|`(7, 263)`| `07 00 00 00 07 01 00 00`
|===

–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –≤ –∫–æ—Ä—Ç–µ–∂ -- zero cost abstraction.footnote:[–ü–∞–¥–¥–∏–Ω–≥.]

== –ö–æ—Ä—Ç–µ–∂–∏

.main.rs
[source,rust]
----
fn main() {
    let t = (92,);
    println!("{:?}", &t as *const (i32,));  // 0x7ffc6b2f6aa4
    println!("{:?}", &t.0 as *const i32);   // 0x7ffc6b2f6aa4
}
----

.main.py
[source,python]
----
t = (92,)
print(id(t))     # 139736506707248
print(id(t[0]))  # 139736504680928
----

== –ú–∞—Å—Å–∏–≤—ã

[cols="2,2,3"]
|===
|`[i32; 0]`|`[i32; 1]`|`[i32; 10]`
|===

NOTE: —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ -- –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, —á–∞—Å—Ç—å —Ç–∏–ø–∞


`[i8; 3]` —ç—Ç–æ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –∏ `(u8, u8, u8)`.

[source,rust]
----
let xs: [u8; 3] = [1, 2, 3];
assert_eq!(xs[0], 1);    // index -- usize
assert_eq!(xs.len(), 3); // len() -- usize

let mut buf = [0u8; 1024];
----

== –°—Å—ã–ª–∫–∏

|===
|`&T`| [.language-rust]`&mut T`
|===

- –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ -- –≤ —Å–ª–µ–¥—É—é—â–µ–π –ª–µ–∫—Ü–∏–∏
- –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ -- —É–∫–∞–∑–∞—Ç–µ–ª—å
- –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `NULL`
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –∂–∏–≤

[source,rust]
----
let mut x: i32 = 92;
let r: &mut i32 = &mut 92; // —è–≤–Ω–æ–µ –≤–∑—è—Ç–∏–µ —Å—Å—ã–ª–∫–∏
*r += 1;                   // —è–≤–Ω–æ–µ —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
----

== –£–∫–∞–∑–∞—Ç–µ–ª–∏

|===
|[.language-rust]`*const T`| [.language-rust]`*mut T`
|===

- –º–æ–≥—É—Ç –±—ã—Ç—å `NULL`
- **–Ω–µ** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç –∂–∏–≤
- —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è -- [.language-rust]`unsafe` –æ–ø–µ—Ä–∞—Ü–∏—è
- –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Ä–µ–¥–∫–æ (ffi –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö)

== Box

|===
|`Box<T>`
|===

- —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –≤ –∫—É—á–µ
- –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `NULL`
- `Box::new` –≤—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å
- –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –Ω–∞ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
- –î–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π C++: `std::unique_ptr`

[source,rust]
----
let x: Box<i32> = Box::new(92);
----

== –°—Ç–µ–∫

[.two-col]
--

[source,rust]
----
fn foo() {
    let a = 1;
    let b = bar();
}

fn bar() -> i32 {
    let c = 2;
    92
}
----

image::stack.svg[]
--

== –ö—É—á–∞

[.two-col]
--

[source,rust]
----
fn foo() {
    let a: Box<i32>;
    a = Box::new(1);
    bar(&*a)
}

fn bar(b: &i32) {
}
----

image::heap.svg[]

--

== !

.–°—Ç–µ–∫
- –±—ã—Å—Ç—Ä–æ: —Å–ª–æ–∂–∏—Ç—å –¥–≤–∞ —á–∏—Å–ª–∞
- –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ
- –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ —Ñ—É–Ω–∫—Ü–∏–∏
- —Ä–∞–∑–º–µ—Ä –∏–∑–≤–µ—Å—Ç–µ–Ω –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

.–ö—É—á–∞
- –º–µ–¥–ª–µ–Ω–Ω–µ–µ: `insert`/`remove` –≤ –¥–µ—Ä–µ–≤–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- —è–≤–Ω—ã–µ `malloc` –∏ `free`
- –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
- –ª—é–±–æ–π —Ä–∞–∑–º–µ—Ä

== !

.–°—Ç–µ–∫
- –ª–æ–∫–∞–ª–µ–Ω –¥–ª—è –ø–æ—Ç–æ–∫–∞
- –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø–æ—Ç–æ–∫–∞ (8mb)
- –º–∞–ø–ø–∏–Ω–≥ –≤ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å –ª–µ–Ω–∏–≤—ã–π
- –µ—Å–ª–∏ _–æ—á–µ–Ω—å_ —Ö–æ—á–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø–æ—Ç–æ–∫–∞
- guard page

.–ö—É—á–∞
- –≥–ª–æ–±–∞–ª—å–Ω–∞ –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞
- `mmap`, `brk` –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

== –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å `free`?

–°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞::
_–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏_ —Å—á–∏—Ç–∞–µ–º –∂–∏–≤—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã, –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º—É—é –ø–∞–º—è—Ç—å.
{empty} +
{empty} +
https://www.cs.virginia.edu/~cs415/reading/bacon-garbage.pdf[Unified theory of grabage collection]

Rust::
_–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏_ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å –≤ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –º–µ—Å—Ç–µ, –∑–∞–ø—Ä–µ—â–∞–µ–º —É–±–µ–≥–∞—é—â–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏.
{empty} +
{empty} +
RAII? –°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞? –°—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ –≤ **F~2~**?


== !

[source,rust]
----
fn foo() {
    let x = Box::new(92); // –≤—ã–∑–æ–≤ alloc
    let r: &i32 = &x;
    use_x(r);
                          // –Ω–µ—è–≤–Ω—ã–π –≤—ã–∑–æ–≤ dealloc
}

fn use_x(x: &i32) {
}
----

–ü–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (`{}`)

== !

[source,rust,subs="quotes"]
----
fn foo() {
    let r: &i32;
    {
        let x = Box::new(92);
        r = &*x;
    }

    use_x(r);
}

fn use_x(x: &i32) {
}
----

== !

[source,rust,subs="quotes"]
----
fn foo() {
    let r: &i32;
    {
        let x = Box::new(92);
        r = [.hl-error]##&*x##; // borrowed value does not live long enough
    }

    use_x(r);
}

fn use_x(x: &i32) {
}
----

== –ü—Ä–æ–±–ª–µ–º–∞

[source,rust]
----
fn foo() {
    let x = Box::new(92);
    let y = x;
}
----

–ï—Å–ª–∏ –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –Ω–∞ –≤—ã—Ö–æ–¥–µ –∏–∑ –±–ª–æ–∫–∞, —Ç–æ –º—ã –æ—Å–≤–æ–±–æ–¥–∏–º –µ—ë –¥–≤–∞–∂–¥—ã?

== –ü—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ (move)

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ
"—Ç—Ä–∞—Ç–∏—Ç" –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å

[source,rust]
----
                        // init              uninit
let y;                  //                   y
let x;                  //                   x, y
let x = Box::new(92);   // x                 y
let t = x;              // t                 x, y
let y = t;              // y                 x, t
// y –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å
----

–ø—Ä–∏-—Å–≤–æ-–∏—Ç—å::
–∑–∞–≤–ª–∞–¥–µ—Ç—å, —Å–∞–º–æ–≤–æ–ª—å–Ω–æ –≤–∑—è—Ç—å –≤ —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –≤—ã–¥–∞—Ç—å –∑–∞ —Å–≤–æ—ë.

[.centered]
== –ü—Ä–∏–º–µ—Ä—ã

.use after move
====
[source,rust,subs="quotes"]
----
let spam = Box::new(92);
let eggs = spam;
println!("{}", [.hl-error]#spam#); // use of moved value spam
----
====

[.centered]
== –ü—Ä–∏–º–µ—Ä—ã

.–≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
====
[source,rust]
----
fn foo() {
    let x = Box::new(92); // alloc
    bar(x);
    // x —Ç—É—Ç –Ω–µ  –æ–ø—Ä–µ–¥–µ–ª—ë–Ω
}

fn bar(x: Box<i32>) {
    // dealloc
}
----
====

== drop

–í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —ç—Ç–æ move: –Ω–∞–ø–∏—à–µ–º —É–¥–∞–ª—è—Ç–æ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

[source,rust]
----
fn drop<T>(_value: T) {
}

fn foo() {
    let x = Box::new(1);
    let y = Box::new(2);
    drop(y);
    drop(x);
}
----

–§—É–Ω–∫—Ü–∏—è `drop` –¥–æ—Å—Ç—É–ø–Ω–∞ –∏–∑ –∫–æ—Ä–æ–±–∫–∏

== –ê—Ñ—Ñ–∏–Ω–Ω—ã–µ —Ç–∏–ø—ã

[subs="quotes"]
----
let x: T = foo() in
if *condition*
    then *then_branch*
    else *else_branch*
----

–û–±—ã—á–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è::
`*condition*`, `*then_branch*`, `*else_branch*` –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `x`

–õ–∏–Ω–µ–π–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è::
–Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `x` —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑.

–ê—Ñ—Ñ–∏–Ω–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è::
–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `x`, –Ω–æ –Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞.

== –ê—Ñ—Ñ–∏–Ω–Ω—ã–µ —Ç–∏–ø—ã

`let [.hl-kw]#x# = 92 in`
[cols="m,d",frame=topbot,grid=rows]
|===
|if [.hl-kw]#x# > 0 then [.hl-kw]#x# else -[.hl-kw]#x#
|—Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

|if [.hl-kw]#x# > 0 then y else  z
|–≤—Å–µ —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞

|if y > 0 then [.hl-kw]#x# else -[.hl-kw]#x#
|–≤—Å–µ —Ç—Ä–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞

|if y > 0 then [.hl-kw]#x# else  z
|–∞—Ñ–∏–Ω–Ω–∞—è, –Ω–æ –Ω–µ –ª–∏–Ω–µ–π–Ω–∞—è
|===

[.centered]
== –û–±—ã—á–Ω—ã–µ —Ç–∏–ø—ã

[.text-center.big]
[subs="quotes"]
----
–ì ‚ä¢ t~1~: T~11~‚ÜíT~12~   –ì ‚ä¢ t~2~: T~11~
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ì ‚ä¢ t~1~ t~2~: T~12~
----

[.invisible]
--
NOTE: —Å—Ç—Ä–æ–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π
--

[.centered]
== –ê—Ñ–∏–Ω–Ω—ã–µ —Ç–∏–ø—ã

[.text-center.big]
[subs="quotes"]
----
–ì~1~ ‚ä¢ t~1~: T~11~‚ÜíT~12~   –ì~2~ ‚ä¢ t~2~: T~11~   –ì = –ì~1~ ‚äî –ì~2~
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–ì ‚ä¢ t~1~ t~2~: T~12~
----

NOTE: —Å—Ç—Ä–æ–∏–º —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π

== –ü—Ä–æ–±–ª–µ–º–∞

–ê —á—Ç–æ –µ—Å–ª–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏—è?

[source,rust]
----
let x = Box::new(92);
let y;
let z;
if condition {
    y = x;
} else {
    z = x;
}
// –ö—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, x –∏–ª–∏ y?
----

== Drop flags

–ê —á—Ç–æ –µ—Å–ª–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏—è?

[source,rust]
----
let x = Box::new(92);
let y;
let z;
if condition {
    y = x;
} else {
    z = x;
}
// –ö—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, x –∏–ª–∏ y?
----

–ù–µ–≤–∏–¥–∏–º—ã–π —Ñ–ª–∞–≥ _–Ω–∞ —Å—Ç–µ–∫–µ_: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è?

–û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫ :o)

== Vec

|===
|`Vec<T>`
|===

- —Ä–∞—Å—à–∏—Ä—è—é—â–∏–π—Å—è –º–∞—Å—Å–∏–≤
- `Box` –¥–ª—è `n` —ç–ª–µ–º–µ–Ω—Ç–æ–≤

[source,rust]
----
pub struct Vec<T> {
    /// –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –≤ –∫—É—á–µ.
    ptr: *const T,
    /// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–µ.
    /// –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç: len <= capacity.
    len: usize,
    /// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—Ç–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–µ (capacity).
    /// –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏.
    cap: usize,
}
----

== Vec

[source,rust]
----
use std::mem::size_of;
assert_eq!(
    size_of::<Vec<i32>>(),
    size_of::<usize>() * 3,
);

let mut xs = vec![1, 2, 3];
xs.push(4);
assert_eq!(xs.len(), 4);
assert_eq!(xs[2], 3);
----

== Vec

[source,rust]
----
let ys;
let xs = vec![1, 2, 3];
ys = xs;
----

image::vec1.svg[width=700]

== Vec

[source,rust]
----
let ys;
let xs = vec![1, 2, 3];
ys = xs;
----

image::vec2.svg[width=700]

== Vec

[source,rust]
----
let ys;
let xs = vec![1, 2, 3];
ys = xs.clone();
----

image::vec3.svg[width=700]

== –í–∏–¥—ã –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è

[source]
----
xs = ys
----

- Python: —É–≤–µ–ª–∏—á–∏–º —Å—á—ë—Ç—á–∏–∫ —Å—Å—ã–ª–æ–∫.
- Java: –∫–æ–ø–∏—Ä—É–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å, —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ –Ω–∞ –Ω–µ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç –ø–æ—Ç–æ–º
  (+ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –±–∞—Ä—å–µ—Ä).
- C++: –¥–µ–ª–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é –æ–±—ä–µ–∫—Ç–∞.
- Rust: –≤ compile-time –ø–æ–º–µ—Ç–∏–º `ys` –∫–∞–∫ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é, –≤ runtime
  —Å–∫–æ–ø–∏—Ä—É–µ–º –±–∞–π—Ç—ã –Ω–∞ —Å—Ç–µ–∫–µ.

== !

.Rust
- move —ç—Ç–æ `memcpy` `size_of::<T>` –±–∞–π—Ç
- –µ—Å—Ç—å –≤—Å–µ–≥–¥–∞, –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π
- –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ -- —è–≤–Ω—ã–π –≤—ã–∑–æ–≤ `.clone`

.{cpp}
- –º–æ–∂–Ω–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å move –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –µ—Å—Ç—å –Ω–µ –≤—Å–µ–≥–¥–∞, –º–æ–∂–µ—Ç –∫–∏–Ω—É—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
- –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -- –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º rvalue-—Å—Å—ã–ª–æ–∫)
- **—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å C++98**

== –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ø–∞–º—è—Ç–∏

* CPU —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –±—ã—Å—Ç—Ä–µ–µ RAM
* –∫—ç—à —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –º–µ–Ω—å—à–µ –∏ –±—ã—Å—Ç—Ä–µ–µ RAM
* —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è -- –¥–æ—Ä–æ–≥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
* –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∫–æ–¥
* –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä **–Ω–µ** –º–æ–∂–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

[.two-col]
== Rust/{cpp}

[source,rust]
----
struct Point { x: f64, y: f64}

let xs: Vec<Point> = ...;
let p: &Point = xs[0];
----

--
image::stack_heap_rust.svg[400,400]
--

[.two-col]
== Java

[source,java,subs="quotes"]
----
[.hl-kw]#class# Point {
    double x;
    double y;
}

ArrayList<Point> xs = ...;
Point p = xs.get(0);
----

--
image::stack_heap_java.svg[400,400]
--

